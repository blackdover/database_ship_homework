# 视图说明文档

## 📊 系统视图总览

系统共创建了 **12 个视图**，覆盖多个业务场景，方便查询和数据分析。

---

## 1. View_Yard_Inventory_Live - 堆场实时库存

**功能**：查看当前堆场中所有集装箱的位置和状态

**主要字段**：
- 位置信息：堆场区、贝位、排号、层号、坐标代码
- 集装箱信息：箱号、箱状态、ISO代码、尺寸、箱型组
- 权属信息：箱主、箱主代码

**使用场景**：
- 堆场库存查询
- 集装箱位置定位
- 库存盘点

**示例查询**：
```sql
SELECT * FROM View_Yard_Inventory_Live 
WHERE 堆场区 = 'A区' 
ORDER BY 贝位, 排号, 层号;
```

---

## 2. View_Task_Details - 任务详情

**功能**：显示任务的完整信息，包括集装箱、位置、用户、船舶等

**主要字段**：
- 任务信息：任务编号、任务类型、任务状态、优先级、实际执行时间
- 集装箱信息：箱号、箱状态、箱型代码、箱尺寸
- 位置信息：起始位置、目标位置（堆场区、贝位、排号、层号、坐标）
- 船舶信息：船舶名称、进口航次、出口航次
- 用户信息：创建人、指派给、执行人

**使用场景**：
- 任务管理
- 任务详情查看
- 任务执行跟踪

**示例查询**：
```sql
SELECT * FROM View_Task_Details 
WHERE 任务状态 = 'Pending' 
ORDER BY 优先级 ASC;
```

---

## 3. View_Vessel_Visit_Details - 船舶访问详情

**功能**：显示船舶访问的完整信息，包括船舶、港口、泊位、统计信息等

**主要字段**：
- 船舶信息：船舶名称、IMO编号、船旗国、承运人
- 港口信息：港口名称、港口代码、泊位名称
- 航次信息：进口航次、出口航次、到港时间、离港时间、访问状态
- 统计信息：任务总数、已完成任务数、集装箱总数、订舱单总数

**使用场景**：
- 船舶访问管理
- 船舶作业统计
- 港口作业分析

**示例查询**：
```sql
SELECT * FROM View_Vessel_Visit_Details 
WHERE 访问状态 = 'Approaching'
ORDER BY 到港时间 ASC;
```

---

## 4. View_Booking_Details - 订舱单详情

**功能**：显示订舱单的完整信息，包括相关方、航次等

**主要字段**：
- 订舱单信息：订舱单编号、订舱号、订舱状态
- 相关方信息：发货人、发货人联系人、发货人邮箱、收货人、收货人联系人、付费方
- 航次信息：航次编号、船舶名称、进口航次、出口航次、港口名称、预计到港时间、预计离港时间

**使用场景**：
- 订舱单管理
- 客户服务
- 业务查询

**示例查询**：
```sql
SELECT * FROM View_Booking_Details 
WHERE 订舱状态 = 'Confirmed'
ORDER BY 预计到港时间 ASC;
```

---

## 5. View_Yard_Utilization - 堆场利用率统计

**功能**：按堆场区统计箱位利用情况

**主要字段**：
- 堆场区信息：堆场区编号、堆场区名称、堆场区类型
- 统计信息：堆栈总数、箱位总数、已占用箱位数、空闲箱位数、利用率_百分比

**使用场景**：
- 堆场容量管理
- 利用率分析
- 资源规划

**示例查询**：
```sql
SELECT * FROM View_Yard_Utilization 
ORDER BY 利用率_百分比 DESC;
```

---

## 6. View_Container_Status_Summary - 集装箱状态统计

**功能**：按状态、箱型统计集装箱数量

**主要字段**：
- 状态信息：集装箱状态
- 箱型信息：箱型代码、箱尺寸_英尺、箱型组
- 统计信息：数量、箱主数量

**使用场景**：
- 集装箱状态分析
- 箱型统计
- 库存分析

**示例查询**：
```sql
SELECT * FROM View_Container_Status_Summary 
WHERE 集装箱状态 = 'InYard'
ORDER BY 数量 DESC;
```

---

## 7. View_User_Permissions - 用户权限

**功能**：显示用户及其拥有的权限

**主要字段**：
- 用户信息：用户编号、用户名、全名、邮箱、是否激活、关联相关方
- 权限信息：权限列表、权限数量

**使用场景**：
- 权限管理
- 用户权限查询
- 权限审计

**示例查询**：
```sql
SELECT * FROM View_User_Permissions 
WHERE 是否激活 = 1
ORDER BY 权限数量 DESC;
```

---

## 8. View_Task_Execution_Stats - 任务执行统计

**功能**：按用户统计任务执行情况

**主要字段**：
- 用户信息：用户编号、用户名、全名
- 任务统计：创建任务数、被指派任务数、执行任务数、已完成任务数、待执行任务数
- 任务类型统计：装船任务数、卸船任务数、进闸任务数、出闸任务数

**使用场景**：
- 员工绩效统计
- 工作量分析
- 任务分配优化

**示例查询**：
```sql
SELECT * FROM View_Task_Execution_Stats 
ORDER BY 执行任务数 DESC;
```

---

## 9. View_Container_Location_Tracking - 集装箱位置追踪

**功能**：显示所有集装箱的当前位置和状态

**主要字段**：
- 集装箱信息：集装箱编号、箱号、当前状态、箱型代码、箱尺寸、箱型组
- 箱主信息：箱主、箱主代码
- 位置信息：当前位置（智能显示）、堆场区、贝位、排号、层号、坐标代码
- 船舶信息：所在船舶、航次

**使用场景**：
- 集装箱追踪
- 位置查询
- 状态监控

**示例查询**：
```sql
SELECT * FROM View_Container_Location_Tracking 
WHERE 箱号 = 'ABCD1234567';
```

---

## 10. View_Vessel_Visit_Statistics - 船舶访问统计

**功能**：按船舶统计访问次数和集装箱数量

**主要字段**：
- 船舶信息：船舶编号、船舶名称、IMO编号、承运人
- 访问统计：访问次数、已完成访问次数、即将到港次数
- 集装箱统计：处理集装箱总数、装船集装箱数、卸船集装箱数
- 任务统计：任务总数、已完成任务数

**使用场景**：
- 船舶运营分析
- 船舶绩效统计
- 业务分析

**示例查询**：
```sql
SELECT * FROM View_Vessel_Visit_Statistics 
ORDER BY 访问次数 DESC, 处理集装箱总数 DESC;
```

---

## 11. View_Yard_Available_Slots - 堆场空位

**功能**：显示所有可用的堆场空位

**主要字段**：
- 堆场区信息：堆场区编号、堆场区名称、堆场区类型
- 堆栈信息：堆栈编号、贝位、排号
- 箱位信息：箱位编号、层号、坐标代码、箱位状态

**使用场景**：
- 空位查询
- 箱位分配
- 堆场规划

**示例查询**：
```sql
SELECT * FROM View_Yard_Available_Slots 
WHERE 堆场区名称 = 'A区'
ORDER BY 贝位, 排号, 层号;
```

---

## 12. View_Pending_Tasks - 待执行任务

**功能**：显示所有待执行的任务

**主要字段**：
- 任务信息：任务编号、任务类型、优先级
- 集装箱信息：箱号、箱尺寸
- 位置信息：起始位置、目标位置
- 船舶信息：船舶名称、航次
- 用户信息：创建人、指派给、指派给姓名

**使用场景**：
- 任务调度
- 任务分配
- 作业计划

**示例查询**：
```sql
SELECT * FROM View_Pending_Tasks 
WHERE 指派给 = 'operator1'
ORDER BY 优先级 ASC;
```

---

## 📋 视图使用建议

### 1. 权限控制
- 可以只授予用户视图的 SELECT 权限，不授予底层表的权限
- 通过视图实现数据安全隔离

### 2. 性能优化
- 视图可以缓存常用查询结果
- 复杂查询封装在视图中，减少重复编写

### 3. 业务封装
- 将复杂的业务逻辑封装在视图中
- 统一的数据展示逻辑，保证数据一致性

### 4. 数据分析
- 使用统计视图进行数据分析
- 使用详情视图进行数据查询

---

## 🔧 视图维护

### 查看所有视图
```sql
SHOW FULL TABLES WHERE Table_type = 'VIEW';
```

### 查看视图定义
```sql
SHOW CREATE VIEW View_Yard_Inventory_Live;
```

### 删除视图
```sql
DROP VIEW IF EXISTS View_Yard_Inventory_Live;
```

### 重新创建视图
```sql
-- 使用 CREATE OR REPLACE VIEW 可以更新视图定义
CREATE OR REPLACE VIEW View_Yard_Inventory_Live AS
SELECT ...
```

---

## 📊 视图统计

| 视图类型 | 数量 | 说明 |
|---------|------|------|
| 详情视图 | 4个 | 显示完整业务信息 |
| 统计视图 | 4个 | 提供统计分析数据 |
| 追踪视图 | 2个 | 实时位置和状态追踪 |
| 管理视图 | 2个 | 权限和任务管理 |

**总计**：12 个视图，覆盖系统的核心业务场景。



